<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      -->
<title>data_visualizer_exported</title>
<meta name="generator" content="MATLAB 24.2">
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/">
<meta name="DC.date" content="2024-12-16">
<meta name="DC.source" content="data_visualizer_exported.m">
<style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; }

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }
span.typesection { color:#A0522D }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style>
</head>
<body>
<div class="content">
<h2>Contents</h2>
<div>
<ul>
<li>
<a href="#3">Reformat file</a>
</li>
<li>
<a href="#4">Grab the variable data of the checkbox ones</a>
</li>
<li>
<a href="#5">Grab min &amp; max lap and user inputted laps</a>
</li>
<li>
<a href="#6">Default lap A and B</a>
</li>
<li>
<a href="#7">Which variables to plot?</a>
</li>
<li>
<a href="#8">TODO!!!!!! Get lap comparison working with distances</a>
</li>
<li>
<a href="#9">Plot!</a>
</li>
</ul>
</div>
<pre class="codeinput">
<span class="keyword">classdef</span> data_visualizer_exported &lt; matlab.apps.AppBase

    <span class="comment">% Properties that correspond to app components</span>
    <span class="keyword">properties</span> (Access = public)
        MRacing2024DataVisualizerUIFigure  <span class="typesection">matlab.ui.Figure</span>
        plot_wrt_group          <span class="typesection">matlab.ui.container.ButtonGroup</span>
        distance_button         <span class="typesection">matlab.ui.control.ToggleButton</span>
        time_button             <span class="typesection">matlab.ui.control.ToggleButton</span>
        vert_gs_check           <span class="typesection">matlab.ui.control.CheckBox</span>
        lat_gs_check            <span class="typesection">matlab.ui.control.CheckBox</span>
        long_gs_check           <span class="typesection">matlab.ui.control.CheckBox</span>
        yaw_rate_check          <span class="typesection">matlab.ui.control.CheckBox</span>
        pitch_rate_check        <span class="typesection">matlab.ui.control.CheckBox</span>
        roll_rate_check         <span class="typesection">matlab.ui.control.CheckBox</span>
        vehichle_heading_check  <span class="typesection">matlab.ui.control.CheckBox</span>
        vehicle_speed_check     <span class="typesection">matlab.ui.control.CheckBox</span>
        avg_speed_check         <span class="typesection">matlab.ui.control.CheckBox</span>
        rr_speed_check          <span class="typesection">matlab.ui.control.CheckBox</span>
        rl_speed_check          <span class="typesection">matlab.ui.control.CheckBox</span>
        fr_speed_check          <span class="typesection">matlab.ui.control.CheckBox</span>
        fl_speed_check          <span class="typesection">matlab.ui.control.CheckBox</span>
        brake_bias_check        <span class="typesection">matlab.ui.control.CheckBox</span>
        read_brakes_check       <span class="typesection">matlab.ui.control.CheckBox</span>
        front_brakes_check      <span class="typesection">matlab.ui.control.CheckBox</span>
        brake_position_check    <span class="typesection">matlab.ui.control.CheckBox</span>
        throttle_position_check     <span class="typesection">matlab.ui.control.CheckBox</span>
        github_link             <span class="typesection">matlab.ui.control.Hyperlink</span>
        variables_header        <span class="typesection">matlab.ui.control.Label</span>
        log_file_header         <span class="typesection">matlab.ui.control.Label</span>
        version_label           <span class="typesection">matlab.ui.control.Label</span>
        lapB_edit               <span class="typesection">matlab.ui.control.NumericEditField</span>
        LapBLabel               <span class="typesection">matlab.ui.control.Label</span>
        lapA_edit               <span class="typesection">matlab.ui.control.NumericEditField</span>
        Lap1Label               <span class="typesection">matlab.ui.control.Label</span>
        MainHeader                   <span class="typesection">matlab.ui.control.Label</span>
        mracing_logo            <span class="typesection">matlab.ui.control.Image</span>
        upload_log_button       <span class="typesection">matlab.ui.control.Button</span>
        reformat_file_check     <span class="typesection">matlab.ui.control.CheckBox</span>
        file_label              <span class="typesection">matlab.ui.control.Label</span>
        run_visualizer_button   <span class="typesection">matlab.ui.control.Button</span>
        Image                   <span class="typesection">matlab.ui.control.Image</span>
    <span class="keyword">end</span>


    <span class="keyword">properties</span> (Access = private)
        file = <span class="string">""</span>
        location = <span class="string">""</span>

        <span class="comment">% lap_min % Smallest lap number (should be 0?)</span>
        <span class="comment">% lap_max % Biggest lap number</span>
        <span class="comment">% lapA % Lap 1 number</span>
        <span class="comment">% lapA_t % Lap 1 time</span>
        <span class="comment">% lapB % Lap 2 number</span>
        <span class="comment">% lapB_t % Lap 2 time</span>
        <span class="comment">% lapf % Fast lap number</span>
        <span class="comment">% lapf_t % Fast lap time</span>

    <span class="keyword">end</span>


    <span class="comment">% Callbacks that handle component events</span>
    <span class="keyword">methods</span> (Access = private)

        <span class="comment">% Button pushed function: run_visualizer_button</span>
        <span class="keyword">function</span> run_visualizer(app, event)
</pre>
<pre class="codeinput">            w = warning (<span class="string">'off'</span>,<span class="string">'all'</span>);
            msg = msgbox(<span class="string">"Please wait :)"</span>);
</pre>
<h2 id="3">Reformat file</h2>
<pre class="codeinput">            <span class="keyword">if</span> get(app.reformat_file_check, <span class="string">'Value'</span>) == 1
                <span class="comment">% These are the variables we want to keep in the reformatted file</span>
                <span class="comment">% Make sure 'variables_select' has no carriage returns (\r)!!!!</span>
                relevant_vars = fileread(<span class="string">'variables_relevant.txt'</span>);
                relevant_vars = strsplit(relevant_vars, <span class="string">'\n'</span>);

                <span class="comment">% readtable replaces [ ] / with _ and removes whitespace</span>
                relevant_vars = strrep(relevant_vars, <span class="string">'['</span>, <span class="string">'_'</span>);
                relevant_vars = strrep(relevant_vars, <span class="string">']'</span>, <span class="string">'_'</span>);
                relevant_vars = strrep(relevant_vars, <span class="string">'/'</span>, <span class="string">'_'</span>);
                relevant_vars = strrep(relevant_vars, <span class="string">' '</span>, <span class="string">''</span>);

                data = readtable([app.location, app.file]);
                data = data(:,relevant_vars);

                <span class="comment">% Throttle and brake percentages arent actual percentages lol</span>
                throttle_max = max(data{:,<span class="string">"Pedals_APS_A_percent_"</span>});
                brake_max = max(data{:,<span class="string">"Pedals_APS_B_percent_"</span>});
                data{:,<span class="string">"Pedals_APS_A_percent_"</span>} = data{:,<span class="string">"Pedals_APS_A_percent_"</span>} / throttle_max;
                data{:,<span class="string">"Pedals_APS_B_percent_"</span>} = data{:,<span class="string">"Pedals_APS_B_percent_"</span>} / brake_max;


                <span class="comment">% create new file with same name + ddt_</span>
                app.file = strcat(<span class="string">"ddt_"</span>, app.file);
                writetable(data, strcat(app.location, app.file));
            <span class="keyword">else</span>
                data = readtable([app.location, app.file]);
            <span class="keyword">end</span>
</pre>
<h2 id="4">Grab the variable data of the checkbox ones</h2>
<p>Again, MAKE SURE NO \r!!! Only \n!!!!</p>
<pre class="codeinput">            checkbox_vars = fileread(<span class="string">'variables_checkbox.txt'</span>);
            checkbox_vars = strsplit(checkbox_vars, <span class="string">'\n'</span>);
            checkbox_vars = strrep(checkbox_vars, <span class="string">'['</span>, <span class="string">'_'</span>);
            checkbox_vars = strrep(checkbox_vars, <span class="string">']'</span>, <span class="string">'_'</span>);
            checkbox_vars = strrep(checkbox_vars, <span class="string">'/'</span>, <span class="string">'_'</span>);
            checkbox_vars = strrep(checkbox_vars, <span class="string">' '</span>, <span class="string">''</span>);
            data_checkbox = data(:, checkbox_vars);
</pre>
<h2 id="5">Grab min &amp; max lap and user inputted laps</h2>
<pre class="codeinput">            lap_min = data{1, <span class="string">"Dash_3_Lap_Number_None_"</span>};
            lap_max = data{end, <span class="string">"Dash_3_Lap_Number_None_"</span>};
            lapA = app.lapA_edit.Value;
            lapB = app.lapB_edit.Value;

            <span class="comment">% %% Calc fastest lap</span>
            <span class="comment">% lap_times = data{:,"Dash_3_Lap_Time_s_"};</span>
            <span class="comment">% % Find smallest non-zero lap time</span>
            <span class="comment">% lapf_t = min(lap_times(lap_times&gt;0));</span>
            <span class="comment">% % Edge case: If lap time is always 0</span>
            <span class="comment">% if isempty(lapf_t)</span>
            <span class="comment">%     lapf_t = 0;</span>
            <span class="comment">% end</span>
            <span class="comment">% % Grab row of lapf_t and use it to find lapf number</span>
            <span class="comment">% lapf = data{lap_times==lapf_t, "Dash_3_Lap_Number_None_"}(1);</span>
</pre>
<h2 id="6">Default lap A and B</h2>
<pre class="codeinput">            <span class="keyword">if</span> (isempty(lapA))
                <span class="comment">% lapA = lapf;</span>
                <span class="comment">% lapA_t = lapf_t;</span>
                lapA = false;
                lapA_time = false;
            <span class="keyword">end</span>
            <span class="keyword">if</span> (isempty(lapB))
                lapB = false;
                lapB_time = false;
            <span class="keyword">end</span>

            <span class="comment">% Error message if segmentation fault</span>
            <span class="keyword">if</span> (lapA &lt; lap_min || lapA &gt; lap_max || <span class="keyword">...</span>
                    (lapB &lt; lap_min &amp;&amp; lapB ~= -1) || lapB &gt; lap_max)
                msgbox([<span class="string">"Error: Lap number out of bounds"</span>, <span class="keyword">...</span>
                        <span class="string">"Lap number must be between "</span> + lap_min + <span class="string">" and "</span> + lap_max], <span class="keyword">...</span>
                        <span class="string">"Error: Segmentation Fault"</span>)
                <span class="keyword">return</span>
            <span class="keyword">end</span>
</pre>
<h2 id="7">Which variables to plot?</h2>
<pre class="codeinput">            <span class="comment">% Pedals_APS_A [percent]</span>
            <span class="comment">% Pedals_APS_B [percent]</span>
            <span class="comment">% Pedals_F_Brake [psi]</span>
            <span class="comment">% Pedals_R_Brake [psi]</span>
            <span class="comment">% AMK_ActVal_1_FL_AMK_ActualVelocity [rpm]</span>
            <span class="comment">% AMK_ActVal_1_FR_AMK_ActualVelocity [rpm]</span>
            <span class="comment">% AMK_ActVal_1_RL_AMK_ActualVelocity [rpm]</span>
            <span class="comment">% AMK_ActVal_1_RR_AMK_ActualVelocity [rpm]</span>
            <span class="comment">% Dash_3_Vehicle_Speed [mph]</span>
            <span class="comment">% Dash_4_Brake_Bias [None]</span>
            <span class="comment">% Average_IMU_Long [g]</span>
            <span class="comment">% Average_IMU_Lat [g]</span>
            <span class="comment">% Average_IMU_Vert [g]</span>
            <span class="comment">% Average_IMU_Roll [deg/s]</span>
            <span class="comment">% Average_IMU_Pitch [deg/s]</span>
            <span class="comment">% Average_IMU_Yaw [deg/s]</span>

            <span class="comment">% Needs to be in same order as appears in log file</span>
            axis_checkboxes = [ app.throttle_position_check, app.brake_position_check, app.front_brakes_check, app.read_brakes_check, <span class="keyword">...</span>
                                app.fl_speed_check, app.fr_speed_check, app.rl_speed_check, app.rr_speed_check, <span class="keyword">...</span>
                                app.vehicle_speed_check, app.brake_bias_check, <span class="keyword">...</span>
                                app.long_gs_check, app.lat_gs_check, app.vert_gs_check, <span class="keyword">...</span>
                                app.roll_rate_check, app.pitch_rate_check, app.yaw_rate_check];

            axis_names = string(size(axis_checkboxes));
            axis_values = zeros(size(axis_checkboxes));
            <span class="keyword">for</span> i = 1:size(axis_checkboxes, 2)
                txt = convertCharsToStrings(get(axis_checkboxes(i), <span class="string">'Text'</span>)); <span class="comment">% HOLY SHIT THIS IS FUNNY LMFAOOOOO</span>
                value = get(axis_checkboxes(i), <span class="string">'Value'</span>);
                axis_names(i) = txt;
                <span class="keyword">if</span> value
                    axis_values(i) = 1;
                <span class="keyword">end</span>
            <span class="keyword">end</span>

            selected_vars = 1:size(axis_checkboxes, 2);
            selected_vars = transpose(nonzeros(selected_vars .* axis_values));
            NUM_VARS = size(selected_vars,2);

            wrt_time = get(app.time_button, <span class="string">"Value"</span>);

            <span class="keyword">if</span> lapA == false
                <span class="comment">% Grab data across all laps</span>
                <span class="keyword">if</span> wrt_time
                    lapA_x = data{:,<span class="string">"xtime_s_"</span>};
                <span class="keyword">else</span>
                    lapA_x = data{:,<span class="string">"xdist_m_"</span>};
                <span class="keyword">end</span>
                lapA_selected_data = data_checkbox{:, selected_vars}';

            <span class="keyword">else</span>
                <span class="comment">% Grab data specific to only laps specified</span>
                lapA_data = data(data.Dash_3_Lap_Number_None_ == lapA, :);
                <span class="keyword">if</span> lapB
                    lapB_data = data(data.Dash_3_Lap_Number_None_ == lapB, :);
                <span class="keyword">end</span>

                <span class="comment">% Grab time/distance of lapA and lapB data for domain input</span>
                <span class="keyword">if</span> wrt_time
                    lapA_x = lapA_data{:,<span class="string">"xtime_s_"</span>} - lapA_data{1,<span class="string">"xtime_s_"</span>};
                    <span class="keyword">if</span> lapB
                        lapB_x = lapB_data{:,<span class="string">"xtime_s_"</span>} - lapB_data{1,<span class="string">"xtime_s_"</span>};
                    <span class="keyword">end</span>
                <span class="keyword">else</span>
                    lapA_x = lapA_data{:,<span class="string">"xdist_m_"</span>} - lapA_data{1,<span class="string">"xdist_m_"</span>};
                    <span class="keyword">if</span> lapB
                        lapB_x = lapB_data{:,<span class="string">"xdist_m_"</span>} - lapB_data{1,<span class="string">"xdist_m_"</span>};
                    <span class="keyword">end</span>
                <span class="keyword">end</span>

                <span class="comment">% Grab checkbox variables of lapA and lapB data for range input</span>
                lapA_data_checkbox = lapA_data(:, checkbox_vars);
                lapA_selected_data = lapA_data_checkbox{:, selected_vars}';
                <span class="keyword">if</span> lapB
                    lapB_data_checkbox = lapB_data(:, checkbox_vars);
                    lapB_selected_data = lapB_data_checkbox{:, selected_vars}';
                <span class="keyword">end</span>
            <span class="keyword">end</span>
</pre>
<h2 id="8">TODO!!!!!! Get lap comparison working with distances</h2>
<p>Issue is something with lap distances seg faulting when indexing through the lap data which makes sense ig (?)</p>
<h2 id="9">Plot!</h2>
<pre class="codeinput">            <span class="comment">% timei = 0;</span>
            <span class="comment">% timef = 10;</span>
            <span class="comment">% x = timei:.01:timef;</span>
            <span class="comment">% data1 = [sin(x) ; cos(x) ; tan(x) ; x/10 ; x.^2/10 ; x.^3/10 ; 0*x + 0.5 ; -x/10];</span>
            <span class="comment">% data2 = data1 - 1;</span>
            <span class="comment">% axis_names = ["Var A", "Var B", "Var C", "Var D", "Var E", "Var F", "Var G", "Var H"];</span>
            <span class="comment">% selected_vars = [1,2,3,4,5,6,7,8];</span>

            figureColor = [.94,.94,.94];
            tileColor = [.9,.9,.9];
            textColor = [0,0,0];
            outlineColor = [0,0,0];
            lapAColor = [0, .49, .96];
            lapBColor = [.89, .09, .04];
            set(groot,{<span class="string">'DefaultAxesXColor'</span>,<span class="string">'DefaultAxesYColor'</span>,<span class="string">'DefaultAxesZColor'</span>},{outlineColor,outlineColor,outlineColor})

            f1 = uifigure(<span class="string">'color'</span>, figureColor);

            <span class="comment">% T Tiled layout</span>
            T = tiledlayout(f1, 1,3, <span class="string">"TileSpacing"</span>, <span class="string">"compact"</span>, <span class="string">"Padding"</span>, <span class="string">"compact"</span>);

            <span class="comment">% t1 Tile 1: Tiled layout: Graphs of variables</span>
            t1 = tiledlayout(T, <span class="string">"vertical"</span>, <span class="string">"TileSpacing"</span>, <span class="string">"compact"</span>, <span class="string">"Padding"</span>, <span class="string">"compact"</span>);
            t1.Layout.Tile = 1;
            t1.Layout.TileSpan = [1,2];

            plot_axes = zeros([1, NUM_VARS]);
            <span class="comment">% Subtiles: Individual graphs of variables</span>
            <span class="keyword">for</span> i = 1:NUM_VARS
                ax = nexttile(t1);
                hold(ax, <span class="string">"on"</span>)
                plot(ax, lapA_x, lapA_selected_data(i,:), <span class="string">"Color"</span>, lapAColor);
                <span class="keyword">if</span> lapB
                    plot(ax, lapB_x, lapB_selected_data(i,:), <span class="string">"Color"</span>, lapBColor);
                <span class="keyword">end</span>
                hold(ax, <span class="string">"off"</span>)

                <span class="comment">%curr.ButtonDownFcn = @(h,e) disp(e.IntersectionPoint);</span>

                ax.XGrid = <span class="string">"on"</span>;
                ax.YGrid = <span class="string">"on"</span>;
                ax.XMinorGrid = <span class="string">"on"</span>;
                ax.YMinorGrid = <span class="string">"on"</span>;
                ax.Color = tileColor;
                <span class="comment">%ax.XTick = 0:25:indep_var(end);</span>
                xticklabels(ax, <span class="string">""</span>);
                ax.YLabel.String = axis_names(selected_vars(i));

                plot_axes(i) = ax;
            <span class="keyword">end</span>
            xticklabels(ax, <span class="string">"auto"</span>); <span class="comment">% Enable tick labels for bottom graph</span>
            ax.XTickLabelRotation = 45;
            <span class="keyword">if</span> wrt_time
                ax.XLabel.String = <span class="string">"time (s)"</span>;
            <span class="keyword">else</span>
                ax.XLabel.String = <span class="string">"distance (m)"</span>;
            <span class="keyword">end</span>

            linkaxes(plot_axes, <span class="string">'x'</span>)

            <span class="comment">% t2 Tile 2: Tiled layout: Infobox and map</span>
            t2 = tiledlayout(T, 2,1, <span class="string">"TileSpacing"</span>, <span class="string">"compact"</span>, <span class="string">"Padding"</span>, <span class="string">"none"</span>);
            t2.Layout.Tile = 3;

            x_selected = 0;

            <span class="comment">% t2a Subtile A: Tiled layout: 2 columns for track data of both laps</span>
            ax = nexttile(t2, 1, [1,1]);
            ax.Visible = 0; <span class="comment">% Make axes invisible for text display</span>
            t2a = tiledlayout(t2, 1,2, <span class="string">"TileSpacing"</span>, <span class="string">"none"</span>, <span class="string">"Padding"</span>, <span class="string">"none"</span>);
            t2a.Layout.Tile = 1;

            <span class="comment">% Subsubtile i &amp; ii: Lap data of track 1 &amp; 2</span>
            <span class="keyword">for</span> i = [1,2]
                ax = nexttile(t2a, i, [1,1]);
                ax.XTick = [];
                ax.YTick = [];
                ax.Color = tileColor;
                ax.Box = <span class="string">"on"</span>;

                infoBox_string = <span class="string">"Lap "</span> + i + <span class="string">":\n@ t = "</span> + x_selected(1) + <span class="string">"\n"</span>;
                infoBox_data = zeros(NUM_VARS);
                <span class="keyword">for</span> j = 1:NUM_VARS
                    infoBox_string = infoBox_string + axis_names(selected_vars(j)) + <span class="string">": "</span> + infoBox_data(j) + <span class="string">"\n"</span>;
                <span class="keyword">end</span>

                infoBox_string = regexprep(infoBox_string, <span class="string">"%"</span>, <span class="string">"%%"</span>); <span class="comment">% % is an escape character</span>
                text(ax, 0.05,.975,sprintf(infoBox_string), <span class="string">'Horiz'</span>,<span class="string">'left'</span>, <span class="string">'Vert'</span>,<span class="string">'top'</span>, <span class="keyword">...</span>
                    <span class="string">"Color"</span>, textColor, <span class="string">'fontsize'</span>,5,<span class="string">'fontunits'</span>,<span class="string">'normalized'</span>)
            <span class="keyword">end</span>

            <span class="comment">% Subtile B: GG Diagram</span>
            ax = nexttile(t2, 2, [1,1]);

            lat_g = data_checkbox{:, <span class="string">"Average_IMU_Lat_g_"</span>};
            long_g = data_checkbox{:, <span class="string">"Average_IMU_Long_g_"</span>};
            throttle_pos = data_checkbox{:, <span class="string">"Pedals_APS_A_percent_"</span>};

            scatter(ax, lat_g, long_g, 20, throttle_pos, <span class="string">"Marker"</span>,<span class="string">"."</span>)
            ax.XGrid = <span class="string">"on"</span>;
            ax.YGrid = <span class="string">"on"</span>;
            ax.XMinorGrid = <span class="string">"on"</span>;
            ax.YMinorGrid = <span class="string">"on"</span>;
            ax.XDir = <span class="string">'reverse'</span>;
            ax.Color = tileColor;
            ax.Box = <span class="string">"on"</span>;

            title(ax, <span class="string">"G-G Diagram"</span>);
            colorbar(ax);


            delete(msg)
</pre>
<pre class="codeinput">        <span class="keyword">end</span>

        <span class="comment">% Button pushed function: upload_log_button</span>
        <span class="keyword">function</span> upload_file(app, event)
            dummy = figure(<span class="string">'Renderer'</span>, <span class="string">'painters'</span>, <span class="string">'Position'</span>, [-100 -100 0 0]); <span class="comment">% create a dummy figure so that uigetfile doesn't minimize our GUI</span>
            [f, l] = uigetfile(<span class="string">'*.txt'</span>, <span class="string">"Select log file"</span>);
            delete(dummy); <span class="comment">% delete the dummy figure</span>
            <span class="keyword">if</span> isequal(f, 0)
                <span class="keyword">return</span>
            <span class="keyword">else</span>
                app.file = f;
                app.location = l;
                <span class="comment">%app.upload_log_button.Text = app.file;</span>
                app.file_label.Text = strcat(app.location, app.file);
            <span class="keyword">end</span>
        <span class="keyword">end</span>
    <span class="keyword">end</span>

    <span class="comment">% Component initialization</span>
    methods (Access = private)

        <span class="comment">% Create UIFigure and components</span>
        <span class="keyword">function</span> createComponents(app)

            <span class="comment">% Get the file path for locating images</span>
            pathToMLAPP = fileparts(mfilename(<span class="string">'fullpath'</span>));

            <span class="comment">% Create MRacing2024DataVisualizerUIFigure and hide until all components are created</span>
            app.MRacing2024DataVisualizerUIFigure = uifigure(<span class="string">'Visible'</span>, <span class="string">'off'</span>);
            app.MRacing2024DataVisualizerUIFigure.Position = [100 100 480 720];
            app.MRacing2024DataVisualizerUIFigure.Name = <span class="string">'MRacing 2024 Data Visualizer'</span>;

            <span class="comment">% Create Image</span>
            app.Image = uiimage(app.MRacing2024DataVisualizerUIFigure);
            app.Image.Position = [1 1 480 720];
            app.Image.ImageSource = fullfile(pathToMLAPP, <span class="string">'app_resources'</span>, <span class="string">'background.png'</span>);

            <span class="comment">% Create run_visualizer_button</span>
            app.run_visualizer_button = uibutton(app.MRacing2024DataVisualizerUIFigure, <span class="string">'push'</span>);
            app.run_visualizer_button.ButtonPushedFcn = createCallbackFcn(app, @run_visualizer, true);
            app.run_visualizer_button.BackgroundColor = [0 0.149 0.302];
            app.run_visualizer_button.FontSize = 14;
            app.run_visualizer_button.FontWeight = <span class="string">'bold'</span>;
            app.run_visualizer_button.FontColor = [1 0.8 0.0196];
            app.run_visualizer_button.Position = [20 20 120 30];
            app.run_visualizer_button.Text = <span class="string">'Run Visualizer'</span>;

            <span class="comment">% Create file_label</span>
            app.file_label = uilabel(app.MRacing2024DataVisualizerUIFigure);
            app.file_label.FontSize = 10;
            app.file_label.Tooltip = {<span class="string">''</span>};
            app.file_label.Position = [25 485 430 15];
            app.file_label.Text = <span class="string">'No file selected'</span>;

            <span class="comment">% Create reformat_file_check</span>
            app.reformat_file_check = uicheckbox(app.MRacing2024DataVisualizerUIFigure);
            app.reformat_file_check.Text = <span class="string">'Reformat file'</span>;
            app.reformat_file_check.FontSize = 10;
            app.reformat_file_check.Position = [25 460 80 25];

            <span class="comment">% Create upload_log_button</span>
            app.upload_log_button = uibutton(app.MRacing2024DataVisualizerUIFigure, <span class="string">'push'</span>);
            app.upload_log_button.ButtonPushedFcn = createCallbackFcn(app, @upload_file, true);
            app.upload_log_button.BackgroundColor = [0.902 0.902 0.902];
            app.upload_log_button.FontSize = 10;
            app.upload_log_button.Position = [20 505 100 25];
            app.upload_log_button.Text = <span class="string">'Upload log file'</span>;

            <span class="comment">% Create mracing_logo</span>
            app.mracing_logo = uiimage(app.MRacing2024DataVisualizerUIFigure);
            app.mracing_logo.Position = [20 620 300 80];
            app.mracing_logo.ImageSource = fullfile(pathToMLAPP, <span class="string">'app_resources'</span>, <span class="string">'mracing_logo.png'</span>);

            <span class="comment">% Create MainHeader</span>
            app.MainHeader = uilabel(app.MRacing2024DataVisualizerUIFigure);
            app.MainHeader.FontName = <span class="string">'Century Gothic'</span>;
            app.MainHeader.FontSize = 18;
            app.MainHeader.FontWeight = <span class="string">'bold'</span>;
            app.MainHeader.FontColor = [0 0.149 0.302];
            app.MainHeader.Position = [20 590 305 24];
            app.MainHeader.Text = <span class="string">'DRIVER DATA VISUALIZATION TOOL'</span>;

            <span class="comment">% Create Lap1Label</span>
            app.Lap1Label = uilabel(app.MRacing2024DataVisualizerUIFigure);
            app.Lap1Label.HorizontalAlignment = <span class="string">'right'</span>;
            app.Lap1Label.FontSize = 10;
            app.Lap1Label.Position = [130 505 33 25];
            app.Lap1Label.Text = <span class="string">'Lap A:'</span>;

            <span class="comment">% Create lapA_edit</span>
            app.lapA_edit = uieditfield(app.MRacing2024DataVisualizerUIFigure, <span class="string">'numeric'</span>);
            app.lapA_edit.RoundFractionalValues = <span class="string">'on'</span>;
            app.lapA_edit.AllowEmpty = <span class="string">'on'</span>;
            app.lapA_edit.FontSize = 10;
            app.lapA_edit.Placeholder = <span class="string">'Default all laps'</span>;
            app.lapA_edit.Position = [170 507 80 21];
            app.lapA_edit.Value = [];

            <span class="comment">% Create LapBLabel</span>
            app.LapBLabel = uilabel(app.MRacing2024DataVisualizerUIFigure);
            app.LapBLabel.HorizontalAlignment = <span class="string">'right'</span>;
            app.LapBLabel.FontSize = 10;
            app.LapBLabel.Position = [259 505 34 25];
            app.LapBLabel.Text = <span class="string">'Lap B:'</span>;

            <span class="comment">% Create lapB_edit</span>
            app.lapB_edit = uieditfield(app.MRacing2024DataVisualizerUIFigure, <span class="string">'numeric'</span>);
            app.lapB_edit.RoundFractionalValues = <span class="string">'on'</span>;
            app.lapB_edit.AllowEmpty = <span class="string">'on'</span>;
            app.lapB_edit.FontSize = 10;
            app.lapB_edit.Placeholder = <span class="string">'Default ignore'</span>;
            app.lapB_edit.Position = [300 507 80 21];
            app.lapB_edit.Value = [];

            <span class="comment">% Create version_label</span>
            app.version_label = uilabel(app.MRacing2024DataVisualizerUIFigure);
            app.version_label.HorizontalAlignment = <span class="string">'right'</span>;
            app.version_label.FontName = <span class="string">'Century Gothic'</span>;
            app.version_label.FontColor = [0.502 0.502 0.502];
            app.version_label.Position = [375 670 85 30];
            app.version_label.Text = {<span class="string">'Askari Husaini'</span>; <span class="string">'V24.12.16'</span>};

            <span class="comment">% Create log_file_header</span>
            app.log_file_header = uilabel(app.MRacing2024DataVisualizerUIFigure);
            app.log_file_header.FontName = <span class="string">'Century Gothic'</span>;
            app.log_file_header.FontSize = 14;
            app.log_file_header.FontWeight = <span class="string">'bold'</span>;
            app.log_file_header.FontColor = [0 0.149 0.302];
            app.log_file_header.Position = [20 540 206 25];
            app.log_file_header.Text = <span class="string">'Log File &amp; Lap(s) Analyzed'</span>;

            <span class="comment">% Create variables_header</span>
            app.variables_header = uilabel(app.MRacing2024DataVisualizerUIFigure);
            app.variables_header.FontName = <span class="string">'Century Gothic'</span>;
            app.variables_header.FontSize = 14;
            app.variables_header.FontWeight = <span class="string">'bold'</span>;
            app.variables_header.FontColor = [0 0.149 0.302];
            app.variables_header.Position = [20 410 183 25];
            app.variables_header.Text = <span class="string">'Variables to Visualize'</span>;

            <span class="comment">% Create github_link</span>
            app.github_link = uihyperlink(app.MRacing2024DataVisualizerUIFigure);
            app.github_link.VisitedColor = [0.502 0.502 0.502];
            app.github_link.HorizontalAlignment = <span class="string">'right'</span>;
            app.github_link.FontName = <span class="string">'Century Gothic'</span>;
            app.github_link.FontColor = [0.502 0.502 0.502];
            app.github_link.URL = <span class="string">'https://github.com/askarihusaini/mracing24_ddt'</span>;
            app.github_link.Position = [386 649 74 22];
            app.github_link.Text = <span class="string">'Github repo'</span>;

            <span class="comment">% Create throttle_position_check</span>
            app.throttle_position_check = uicheckbox(app.MRacing2024DataVisualizerUIFigure);
            app.throttle_position_check.Text = <span class="string">'Throttle Position (%)'</span>;
            app.throttle_position_check.FontSize = 10;
            app.throttle_position_check.Position = [25 380 150 22];

            <span class="comment">% Create brake_position_check</span>
            app.brake_position_check = uicheckbox(app.MRacing2024DataVisualizerUIFigure);
            app.brake_position_check.Text = <span class="string">'Brake Position (%)'</span>;
            app.brake_position_check.FontSize = 10;
            app.brake_position_check.Position = [25 359 150 22];

            <span class="comment">% Create front_brakes_check</span>
            app.front_brakes_check = uicheckbox(app.MRacing2024DataVisualizerUIFigure);
            app.front_brakes_check.Text = <span class="string">'Front Brakes (psi)'</span>;
            app.front_brakes_check.FontSize = 10;
            app.front_brakes_check.Position = [25 338 101 22];

            <span class="comment">% Create read_brakes_check</span>
            app.read_brakes_check = uicheckbox(app.MRacing2024DataVisualizerUIFigure);
            app.read_brakes_check.Text = <span class="string">'Rear Brakes (psi)'</span>;
            app.read_brakes_check.FontSize = 10;
            app.read_brakes_check.Position = [25 317 100 22];

            <span class="comment">% Create brake_bias_check</span>
            app.brake_bias_check = uicheckbox(app.MRacing2024DataVisualizerUIFigure);
            app.brake_bias_check.Text = <span class="string">'Brake Bias (#)'</span>;
            app.brake_bias_check.FontSize = 10;
            app.brake_bias_check.Position = [25 296 85 22];

            <span class="comment">% Create fl_speed_check</span>
            app.fl_speed_check = uicheckbox(app.MRacing2024DataVisualizerUIFigure);
            app.fl_speed_check.Text = <span class="string">'FL Tyre Speed (rpm)'</span>;
            app.fl_speed_check.FontSize = 10;
            app.fl_speed_check.Position = [180 380 114 22];

            <span class="comment">% Create fr_speed_check</span>
            app.fr_speed_check = uicheckbox(app.MRacing2024DataVisualizerUIFigure);
            app.fr_speed_check.Text = <span class="string">'FR Tyre Speed (rpm)'</span>;
            app.fr_speed_check.FontSize = 10;
            app.fr_speed_check.Position = [180 359 116 22];

            <span class="comment">% Create rl_speed_check</span>
            app.rl_speed_check = uicheckbox(app.MRacing2024DataVisualizerUIFigure);
            app.rl_speed_check.Text = <span class="string">'RL Tyre Speed (rpm)'</span>;
            app.rl_speed_check.FontSize = 10;
            app.rl_speed_check.Position = [180 338 115 22];

            <span class="comment">% Create rr_speed_check</span>
            app.rr_speed_check = uicheckbox(app.MRacing2024DataVisualizerUIFigure);
            app.rr_speed_check.Text = <span class="string">'RR Tyre Speed (rpm)'</span>;
            app.rr_speed_check.FontSize = 10;
            app.rr_speed_check.Position = [180 317 117 22];

            <span class="comment">% % Create avg_speed_check</span>
            <span class="comment">% app.avg_speed_check = uicheckbox(app.MRacing2024DataVisualizerUIFigure);</span>
            <span class="comment">% app.avg_speed_check.Text = 'Average Tyre Speed (rpm)';</span>
            <span class="comment">% app.avg_speed_check.FontSize = 10;</span>
            <span class="comment">% app.avg_speed_check.Position = [180 296 139 22];</span>

            <span class="comment">% Create vehicle_speed_check</span>
            app.vehicle_speed_check = uicheckbox(app.MRacing2024DataVisualizerUIFigure);
            app.vehicle_speed_check.Text = <span class="string">'Vehichle Speed (mph)'</span>;
            app.vehicle_speed_check.FontSize = 10;
            app.vehicle_speed_check.Position = [335 380 120 22];

            <span class="comment">% Create vehichle_heading_check</span>
            app.vehichle_heading_check = uicheckbox(app.MRacing2024DataVisualizerUIFigure);
            app.vehichle_heading_check.Text = <span class="string">'! TODO: Heading (deg)'</span>;
            app.vehichle_heading_check.FontSize = 10;
            app.vehichle_heading_check.Position = [335 359 126 22];

            <span class="comment">% Create roll_rate_check</span>
            app.roll_rate_check = uicheckbox(app.MRacing2024DataVisualizerUIFigure);
            app.roll_rate_check.Text = <span class="string">'Roll Rate (deg/s)'</span>;
            app.roll_rate_check.FontSize = 10;
            app.roll_rate_check.Position = [335 338 97 22];

            <span class="comment">% Create pitch_rate_check</span>
            app.pitch_rate_check = uicheckbox(app.MRacing2024DataVisualizerUIFigure);
            app.pitch_rate_check.Text = <span class="string">'Pitch Rate (deg/s)'</span>;
            app.pitch_rate_check.FontSize = 10;
            app.pitch_rate_check.Position = [335 317 102 22];

            <span class="comment">% Create yaw_rate_check</span>
            app.yaw_rate_check = uicheckbox(app.MRacing2024DataVisualizerUIFigure);
            app.yaw_rate_check.Text = <span class="string">'Yaw Rate (deg/s)'</span>;
            app.yaw_rate_check.FontSize = 10;
            app.yaw_rate_check.Position = [335 296 99 22];

            <span class="comment">% Create long_gs_check</span>
            app.long_gs_check = uicheckbox(app.MRacing2024DataVisualizerUIFigure);
            app.long_gs_check.Text = <span class="string">'Longitudinal Gs (g)'</span>;
            app.long_gs_check.FontSize = 10;
            app.long_gs_check.Position = [25 265 106 22];

            <span class="comment">% Create lat_gs_check</span>
            app.lat_gs_check = uicheckbox(app.MRacing2024DataVisualizerUIFigure);
            app.lat_gs_check.Text = <span class="string">'Lateral Gs (g)'</span>;
            app.lat_gs_check.FontSize = 10;
            app.lat_gs_check.Position = [25 244 83 22];

            <span class="comment">% Create vert_gs_check</span>
            app.vert_gs_check = uicheckbox(app.MRacing2024DataVisualizerUIFigure);
            app.vert_gs_check.Text = <span class="string">'Vertical Gs (g)'</span>;
            app.vert_gs_check.FontSize = 10;
            app.vert_gs_check.Position = [25 223 85 22];

            <span class="comment">% Create plot_wrt_group</span>
            app.plot_wrt_group = uibuttongroup(app.MRacing2024DataVisualizerUIFigure);
            app.plot_wrt_group.Title = <span class="string">'Plot w.r.t'</span>;
            app.plot_wrt_group.Position = [20 114 123 85];

            <span class="comment">% Create time_button</span>
            app.time_button = uitogglebutton(app.plot_wrt_group);
            app.time_button.Text = <span class="string">'time'</span>;
            app.time_button.Position = [11 31 100 23];
            app.time_button.Value = true;

            <span class="comment">% Create distance_button</span>
            app.distance_button = uitogglebutton(app.plot_wrt_group);
            app.distance_button.Text = <span class="string">'distance'</span>;
            app.distance_button.Position = [11 10 100 23];

            <span class="comment">% Show the figure after all components are created</span>
            app.MRacing2024DataVisualizerUIFigure.Visible = <span class="string">'on'</span>;
        <span class="keyword">end</span>
    <span class="keyword">end</span>

    <span class="comment">% App creation and deletion</span>
    methods (Access = public)

        <span class="comment">% Construct app</span>
        <span class="keyword">function</span> app = data_visualizer_exported

            <span class="comment">% Create UIFigure and components</span>
            createComponents(app)

            <span class="comment">% Register the app with App Designer</span>
            registerApp(app, app.MRacing2024DataVisualizerUIFigure)

            <span class="keyword">if</span> nargout == 0
                clear <span class="string">app</span>
            <span class="keyword">end</span>
        <span class="keyword">end</span>

        <span class="comment">% Code that executes before app deletion</span>
        <span class="keyword">function</span> delete(app)

            <span class="comment">% Delete UIFigure when app is deleted</span>
            delete(app.MRacing2024DataVisualizerUIFigure)
        <span class="keyword">end</span>
    <span class="keyword">end</span>
<span class="keyword">end</span>
</pre>
<p class="footer">
<br>
<a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2024b</a>
<br>
</p>
</div>
<!--
##### SOURCE BEGIN #####
classdef data_visualizer_exported < matlab.apps.AppBase

    % Properties that correspond to app components
    properties (Access = public)
        MRacing2024DataVisualizerUIFigure  matlab.ui.Figure
        plot_wrt_group          matlab.ui.container.ButtonGroup
        distance_button         matlab.ui.control.ToggleButton
        time_button             matlab.ui.control.ToggleButton
        vert_gs_check           matlab.ui.control.CheckBox
        lat_gs_check            matlab.ui.control.CheckBox
        long_gs_check           matlab.ui.control.CheckBox
        yaw_rate_check          matlab.ui.control.CheckBox
        pitch_rate_check        matlab.ui.control.CheckBox
        roll_rate_check         matlab.ui.control.CheckBox
        vehichle_heading_check  matlab.ui.control.CheckBox
        vehicle_speed_check     matlab.ui.control.CheckBox
        avg_speed_check         matlab.ui.control.CheckBox
        rr_speed_check          matlab.ui.control.CheckBox
        rl_speed_check          matlab.ui.control.CheckBox
        fr_speed_check          matlab.ui.control.CheckBox
        fl_speed_check          matlab.ui.control.CheckBox
        brake_bias_check        matlab.ui.control.CheckBox
        read_brakes_check       matlab.ui.control.CheckBox
        front_brakes_check      matlab.ui.control.CheckBox
        brake_position_check    matlab.ui.control.CheckBox
        throttle_position_check     matlab.ui.control.CheckBox
        github_link             matlab.ui.control.Hyperlink
        variables_header        matlab.ui.control.Label
        log_file_header         matlab.ui.control.Label
        version_label           matlab.ui.control.Label
        lapB_edit               matlab.ui.control.NumericEditField
        LapBLabel               matlab.ui.control.Label
        lapA_edit               matlab.ui.control.NumericEditField
        Lap1Label               matlab.ui.control.Label
        MainHeader                   matlab.ui.control.Label
        mracing_logo            matlab.ui.control.Image
        upload_log_button       matlab.ui.control.Button
        reformat_file_check     matlab.ui.control.CheckBox
        file_label              matlab.ui.control.Label
        run_visualizer_button   matlab.ui.control.Button
        Image                   matlab.ui.control.Image
    end

    
    properties (Access = private)
        file = ""
        location = ""

        % lap_min % Smallest lap number (should be 0?)
        % lap_max % Biggest lap number
        % lapA % Lap 1 number
        % lapA_t % Lap 1 time
        % lapB % Lap 2 number
        % lapB_t % Lap 2 time
        % lapf % Fast lap number
        % lapf_t % Fast lap time

    end
    

    % Callbacks that handle component events
    methods (Access = private)

        % Button pushed function: run_visualizer_button
        function run_visualizer(app, event)
            
            w = warning ('off','all');
            msg = msgbox("Please wait :)");

            %% Reformat file
            if get(app.reformat_file_check, 'Value') == 1
                % These are the variables we want to keep in the reformatted file
                % Make sure 'variables_select' has no carriage returns (\r)!!!!
                relevant_vars = fileread('variables_relevant.txt');
                relevant_vars = strsplit(relevant_vars, '\n');

                % readtable replaces [ ] / with _ and removes whitespace
                relevant_vars = strrep(relevant_vars, '[', '_');
                relevant_vars = strrep(relevant_vars, ']', '_');
                relevant_vars = strrep(relevant_vars, '/', '_');
                relevant_vars = strrep(relevant_vars, ' ', '');

                data = readtable([app.location, app.file]);
                data = data(:,relevant_vars);

                % Throttle and brake percentages arent actual percentages lol
                throttle_max = max(data{:,"Pedals_APS_A_percent_"});
                brake_max = max(data{:,"Pedals_APS_B_percent_"});
                data{:,"Pedals_APS_A_percent_"} = data{:,"Pedals_APS_A_percent_"} / throttle_max;
                data{:,"Pedals_APS_B_percent_"} = data{:,"Pedals_APS_B_percent_"} / brake_max;


                % create new file with same name + ddt_
                app.file = strcat("ddt_", app.file);
                writetable(data, strcat(app.location, app.file));
            else
                data = readtable([app.location, app.file]);
            end

            %% Grab the variable data of the checkbox ones
            % Again, MAKE SURE NO \r!!! Only \n!!!!
            checkbox_vars = fileread('variables_checkbox.txt');
            checkbox_vars = strsplit(checkbox_vars, '\n');
            checkbox_vars = strrep(checkbox_vars, '[', '_');
            checkbox_vars = strrep(checkbox_vars, ']', '_');
            checkbox_vars = strrep(checkbox_vars, '/', '_');
            checkbox_vars = strrep(checkbox_vars, ' ', '');
            data_checkbox = data(:, checkbox_vars);

            %% Grab min & max lap and user inputted laps
            lap_min = data{1, "Dash_3_Lap_Number_None_"};
            lap_max = data{end, "Dash_3_Lap_Number_None_"};
            lapA = app.lapA_edit.Value;
            lapB = app.lapB_edit.Value;

            % %% Calc fastest lap
            % lap_times = data{:,"Dash_3_Lap_Time_s_"};
            % % Find smallest non-zero lap time
            % lapf_t = min(lap_times(lap_times>0));
            % % Edge case: If lap time is always 0
            % if isempty(lapf_t)
            %     lapf_t = 0;
            % end
            % % Grab row of lapf_t and use it to find lapf number
            % lapf = data{lap_times==lapf_t, "Dash_3_Lap_Number_None_"}(1);

            %% Default lap A and B
            if (isempty(lapA))
                % lapA = lapf;
                % lapA_t = lapf_t;
                lapA = false;
                lapA_time = false;
            end
            if (isempty(lapB))
                lapB = false;
                lapB_time = false;
            end

            % Error message if segmentation fault
            if (lapA < lap_min || lapA > lap_max || ...
                    (lapB < lap_min && lapB ~= -1) || lapB > lap_max)
                msgbox(["Error: Lap number out of bounds", ...
                        "Lap number must be between " + lap_min + " and " + lap_max], ...
                        "Error: Segmentation Fault")
                return
            end
           
            %% Which variables to plot?

            % Pedals_APS_A [percent]
            % Pedals_APS_B [percent]
            % Pedals_F_Brake [psi]
            % Pedals_R_Brake [psi]
            % AMK_ActVal_1_FL_AMK_ActualVelocity [rpm]
            % AMK_ActVal_1_FR_AMK_ActualVelocity [rpm]
            % AMK_ActVal_1_RL_AMK_ActualVelocity [rpm]
            % AMK_ActVal_1_RR_AMK_ActualVelocity [rpm]
            % Dash_3_Vehicle_Speed [mph]
            % Dash_4_Brake_Bias [None]
            % Average_IMU_Long [g]
            % Average_IMU_Lat [g]
            % Average_IMU_Vert [g]
            % Average_IMU_Roll [deg/s]
            % Average_IMU_Pitch [deg/s]
            % Average_IMU_Yaw [deg/s]

            % Needs to be in same order as appears in log file
            axis_checkboxes = [ app.throttle_position_check, app.brake_position_check, app.front_brakes_check, app.read_brakes_check, ...
                                app.fl_speed_check, app.fr_speed_check, app.rl_speed_check, app.rr_speed_check, ...
                                app.vehicle_speed_check, app.brake_bias_check, ...
                                app.long_gs_check, app.lat_gs_check, app.vert_gs_check, ...
                                app.roll_rate_check, app.pitch_rate_check, app.yaw_rate_check];

            axis_names = string(size(axis_checkboxes));
            axis_values = zeros(size(axis_checkboxes));
            for i = 1:size(axis_checkboxes, 2)
                txt = convertCharsToStrings(get(axis_checkboxes(i), 'Text')); % HOLY SHIT THIS IS FUNNY LMFAOOOOO
                value = get(axis_checkboxes(i), 'Value');
                axis_names(i) = txt;
                if value
                    axis_values(i) = 1;
                end
            end

            selected_vars = 1:size(axis_checkboxes, 2);
            selected_vars = transpose(nonzeros(selected_vars .* axis_values));
            NUM_VARS = size(selected_vars,2);

            wrt_time = get(app.time_button, "Value");

            if lapA == false
                % Grab data across all laps
                if wrt_time
                    lapA_x = data{:,"xtime_s_"};
                else
                    lapA_x = data{:,"xdist_m_"};
                end
                lapA_selected_data = data_checkbox{:, selected_vars}';

            else
                % Grab data specific to only laps specified
                lapA_data = data(data.Dash_3_Lap_Number_None_ == lapA, :);
                if lapB
                    lapB_data = data(data.Dash_3_Lap_Number_None_ == lapB, :);
                end
    
                % Grab time/distance of lapA and lapB data for domain input
                if wrt_time
                    lapA_x = lapA_data{:,"xtime_s_"} - lapA_data{1,"xtime_s_"};
                    if lapB
                        lapB_x = lapB_data{:,"xtime_s_"} - lapB_data{1,"xtime_s_"};
                    end
                else
                    lapA_x = lapA_data{:,"xdist_m_"} - lapA_data{1,"xdist_m_"};
                    if lapB
                        lapB_x = lapB_data{:,"xdist_m_"} - lapB_data{1,"xdist_m_"};
                    end
                end
    
                % Grab checkbox variables of lapA and lapB data for range input
                lapA_data_checkbox = lapA_data(:, checkbox_vars);
                lapA_selected_data = lapA_data_checkbox{:, selected_vars}';
                if lapB
                    lapB_data_checkbox = lapB_data(:, checkbox_vars);
                    lapB_selected_data = lapB_data_checkbox{:, selected_vars}';
                end
            end

            %% TODO!!!!!! Get lap comparison working with distances
            % Issue is something with lap distances seg faulting when
            % indexing through the lap data which makes sense ig (?)

            %% Plot!

            % timei = 0;
            % timef = 10;
            % x = timei:.01:timef;
            % data1 = [sin(x) ; cos(x) ; tan(x) ; x/10 ; x.^2/10 ; x.^3/10 ; 0*x + 0.5 ; -x/10];
            % data2 = data1 - 1;
            % axis_names = ["Var A", "Var B", "Var C", "Var D", "Var E", "Var F", "Var G", "Var H"];
            % selected_vars = [1,2,3,4,5,6,7,8];

            figureColor = [.94,.94,.94];
            tileColor = [.9,.9,.9];
            textColor = [0,0,0];
            outlineColor = [0,0,0];
            lapAColor = [0, .49, .96];
            lapBColor = [.89, .09, .04];
            set(groot,{'DefaultAxesXColor','DefaultAxesYColor','DefaultAxesZColor'},{outlineColor,outlineColor,outlineColor})
            
            f1 = uifigure('color', figureColor);
            
            % T Tiled layout
            T = tiledlayout(f1, 1,3, "TileSpacing", "compact", "Padding", "compact");
            
            % t1 Tile 1: Tiled layout: Graphs of variables
            t1 = tiledlayout(T, "vertical", "TileSpacing", "compact", "Padding", "compact");
            t1.Layout.Tile = 1;
            t1.Layout.TileSpan = [1,2];

            plot_axes = zeros([1, NUM_VARS]);
            % Subtiles: Individual graphs of variables
            for i = 1:NUM_VARS
                ax = nexttile(t1);
                hold(ax, "on")
                plot(ax, lapA_x, lapA_selected_data(i,:), "Color", lapAColor);
                if lapB
                    plot(ax, lapB_x, lapB_selected_data(i,:), "Color", lapBColor);
                end
                hold(ax, "off")
            
                %curr.ButtonDownFcn = @(h,e) disp(e.IntersectionPoint);
        
                ax.XGrid = "on";
                ax.YGrid = "on";
                ax.XMinorGrid = "on";
                ax.YMinorGrid = "on";
                ax.Color = tileColor;
                %ax.XTick = 0:25:indep_var(end);
                xticklabels(ax, "");
                ax.YLabel.String = axis_names(selected_vars(i));

                plot_axes(i) = ax;
            end
            xticklabels(ax, "auto"); % Enable tick labels for bottom graph
            ax.XTickLabelRotation = 45;
            if wrt_time
                ax.XLabel.String = "time (s)";
            else
                ax.XLabel.String = "distance (m)";
            end

            linkaxes(plot_axes, 'x')
            
            % t2 Tile 2: Tiled layout: Infobox and map
            t2 = tiledlayout(T, 2,1, "TileSpacing", "compact", "Padding", "none");
            t2.Layout.Tile = 3;
            
            x_selected = 0;
            
            % t2a Subtile A: Tiled layout: 2 columns for track data of both laps
            ax = nexttile(t2, 1, [1,1]);
            ax.Visible = 0; % Make axes invisible for text display
            t2a = tiledlayout(t2, 1,2, "TileSpacing", "none", "Padding", "none");
            t2a.Layout.Tile = 1;
            
            % Subsubtile i & ii: Lap data of track 1 & 2
            for i = [1,2]
                ax = nexttile(t2a, i, [1,1]);
                ax.XTick = [];
                ax.YTick = [];
                ax.Color = tileColor;
                ax.Box = "on";
            
                infoBox_string = "Lap " + i + ":\n@ t = " + x_selected(1) + "\n";
                infoBox_data = zeros(NUM_VARS);
                for j = 1:NUM_VARS
                    infoBox_string = infoBox_string + axis_names(selected_vars(j)) + ": " + infoBox_data(j) + "\n";
                end
            
                infoBox_string = regexprep(infoBox_string, "%", "%%"); % % is an escape character
                text(ax, 0.05,.975,sprintf(infoBox_string), 'Horiz','left', 'Vert','top', ...
                    "Color", textColor, 'fontsize',5,'fontunits','normalized')
            end
            
            % Subtile B: GG Diagram
            ax = nexttile(t2, 2, [1,1]);

            lat_g = data_checkbox{:, "Average_IMU_Lat_g_"};
            long_g = data_checkbox{:, "Average_IMU_Long_g_"};
            throttle_pos = data_checkbox{:, "Pedals_APS_A_percent_"};

            scatter(ax, lat_g, long_g, 20, throttle_pos, "Marker",".")
            ax.XGrid = "on";
            ax.YGrid = "on";
            ax.XMinorGrid = "on";
            ax.YMinorGrid = "on";
            ax.XDir = 'reverse';
            ax.Color = tileColor;
            ax.Box = "on";

            title(ax, "G-G Diagram");
            colorbar(ax);
            

            delete(msg)
        end

        % Button pushed function: upload_log_button
        function upload_file(app, event)
            dummy = figure('Renderer', 'painters', 'Position', [-100 -100 0 0]); % create a dummy figure so that uigetfile doesn't minimize our GUI
            [f, l] = uigetfile('*.txt', "Select log file");
            delete(dummy); % delete the dummy figure
            if isequal(f, 0)
                return
            else
                app.file = f;
                app.location = l;
                %app.upload_log_button.Text = app.file;
                app.file_label.Text = strcat(app.location, app.file);
            end
        end
    end

    % Component initialization
    methods (Access = private)

        % Create UIFigure and components
        function createComponents(app)

            % Get the file path for locating images
            pathToMLAPP = fileparts(mfilename('fullpath'));

            % Create MRacing2024DataVisualizerUIFigure and hide until all components are created
            app.MRacing2024DataVisualizerUIFigure = uifigure('Visible', 'off');
            app.MRacing2024DataVisualizerUIFigure.Position = [100 100 480 720];
            app.MRacing2024DataVisualizerUIFigure.Name = 'MRacing 2024 Data Visualizer';

            % Create Image
            app.Image = uiimage(app.MRacing2024DataVisualizerUIFigure);
            app.Image.Position = [1 1 480 720];
            app.Image.ImageSource = fullfile(pathToMLAPP, 'app_resources', 'background.png');

            % Create run_visualizer_button
            app.run_visualizer_button = uibutton(app.MRacing2024DataVisualizerUIFigure, 'push');
            app.run_visualizer_button.ButtonPushedFcn = createCallbackFcn(app, @run_visualizer, true);
            app.run_visualizer_button.BackgroundColor = [0 0.149 0.302];
            app.run_visualizer_button.FontSize = 14;
            app.run_visualizer_button.FontWeight = 'bold';
            app.run_visualizer_button.FontColor = [1 0.8 0.0196];
            app.run_visualizer_button.Position = [20 20 120 30];
            app.run_visualizer_button.Text = 'Run Visualizer';

            % Create file_label
            app.file_label = uilabel(app.MRacing2024DataVisualizerUIFigure);
            app.file_label.FontSize = 10;
            app.file_label.Tooltip = {''};
            app.file_label.Position = [25 485 430 15];
            app.file_label.Text = 'No file selected';

            % Create reformat_file_check
            app.reformat_file_check = uicheckbox(app.MRacing2024DataVisualizerUIFigure);
            app.reformat_file_check.Text = 'Reformat file';
            app.reformat_file_check.FontSize = 10;
            app.reformat_file_check.Position = [25 460 80 25];

            % Create upload_log_button
            app.upload_log_button = uibutton(app.MRacing2024DataVisualizerUIFigure, 'push');
            app.upload_log_button.ButtonPushedFcn = createCallbackFcn(app, @upload_file, true);
            app.upload_log_button.BackgroundColor = [0.902 0.902 0.902];
            app.upload_log_button.FontSize = 10;
            app.upload_log_button.Position = [20 505 100 25];
            app.upload_log_button.Text = 'Upload log file';

            % Create mracing_logo
            app.mracing_logo = uiimage(app.MRacing2024DataVisualizerUIFigure);
            app.mracing_logo.Position = [20 620 300 80];
            app.mracing_logo.ImageSource = fullfile(pathToMLAPP, 'app_resources', 'mracing_logo.png');

            % Create MainHeader
            app.MainHeader = uilabel(app.MRacing2024DataVisualizerUIFigure);
            app.MainHeader.FontName = 'Century Gothic';
            app.MainHeader.FontSize = 18;
            app.MainHeader.FontWeight = 'bold';
            app.MainHeader.FontColor = [0 0.149 0.302];
            app.MainHeader.Position = [20 590 305 24];
            app.MainHeader.Text = 'DRIVER DATA VISUALIZATION TOOL';

            % Create Lap1Label
            app.Lap1Label = uilabel(app.MRacing2024DataVisualizerUIFigure);
            app.Lap1Label.HorizontalAlignment = 'right';
            app.Lap1Label.FontSize = 10;
            app.Lap1Label.Position = [130 505 33 25];
            app.Lap1Label.Text = 'Lap A:';

            % Create lapA_edit
            app.lapA_edit = uieditfield(app.MRacing2024DataVisualizerUIFigure, 'numeric');
            app.lapA_edit.RoundFractionalValues = 'on';
            app.lapA_edit.AllowEmpty = 'on';
            app.lapA_edit.FontSize = 10;
            app.lapA_edit.Placeholder = 'Default all laps';
            app.lapA_edit.Position = [170 507 80 21];
            app.lapA_edit.Value = [];

            % Create LapBLabel
            app.LapBLabel = uilabel(app.MRacing2024DataVisualizerUIFigure);
            app.LapBLabel.HorizontalAlignment = 'right';
            app.LapBLabel.FontSize = 10;
            app.LapBLabel.Position = [259 505 34 25];
            app.LapBLabel.Text = 'Lap B:';

            % Create lapB_edit
            app.lapB_edit = uieditfield(app.MRacing2024DataVisualizerUIFigure, 'numeric');
            app.lapB_edit.RoundFractionalValues = 'on';
            app.lapB_edit.AllowEmpty = 'on';
            app.lapB_edit.FontSize = 10;
            app.lapB_edit.Placeholder = 'Default ignore';
            app.lapB_edit.Position = [300 507 80 21];
            app.lapB_edit.Value = [];

            % Create version_label
            app.version_label = uilabel(app.MRacing2024DataVisualizerUIFigure);
            app.version_label.HorizontalAlignment = 'right';
            app.version_label.FontName = 'Century Gothic';
            app.version_label.FontColor = [0.502 0.502 0.502];
            app.version_label.Position = [375 670 85 30];
            app.version_label.Text = {'Askari Husaini'; 'V24.12.16'};

            % Create log_file_header
            app.log_file_header = uilabel(app.MRacing2024DataVisualizerUIFigure);
            app.log_file_header.FontName = 'Century Gothic';
            app.log_file_header.FontSize = 14;
            app.log_file_header.FontWeight = 'bold';
            app.log_file_header.FontColor = [0 0.149 0.302];
            app.log_file_header.Position = [20 540 206 25];
            app.log_file_header.Text = 'Log File & Lap(s) Analyzed';

            % Create variables_header
            app.variables_header = uilabel(app.MRacing2024DataVisualizerUIFigure);
            app.variables_header.FontName = 'Century Gothic';
            app.variables_header.FontSize = 14;
            app.variables_header.FontWeight = 'bold';
            app.variables_header.FontColor = [0 0.149 0.302];
            app.variables_header.Position = [20 410 183 25];
            app.variables_header.Text = 'Variables to Visualize';

            % Create github_link
            app.github_link = uihyperlink(app.MRacing2024DataVisualizerUIFigure);
            app.github_link.VisitedColor = [0.502 0.502 0.502];
            app.github_link.HorizontalAlignment = 'right';
            app.github_link.FontName = 'Century Gothic';
            app.github_link.FontColor = [0.502 0.502 0.502];
            app.github_link.URL = 'https://github.com/askarihusaini/mracing24_ddt';
            app.github_link.Position = [386 649 74 22];
            app.github_link.Text = 'Github repo';

            % Create throttle_position_check
            app.throttle_position_check = uicheckbox(app.MRacing2024DataVisualizerUIFigure);
            app.throttle_position_check.Text = 'Throttle Position (%)';
            app.throttle_position_check.FontSize = 10;
            app.throttle_position_check.Position = [25 380 150 22];

            % Create brake_position_check
            app.brake_position_check = uicheckbox(app.MRacing2024DataVisualizerUIFigure);
            app.brake_position_check.Text = 'Brake Position (%)';
            app.brake_position_check.FontSize = 10;
            app.brake_position_check.Position = [25 359 150 22];

            % Create front_brakes_check
            app.front_brakes_check = uicheckbox(app.MRacing2024DataVisualizerUIFigure);
            app.front_brakes_check.Text = 'Front Brakes (psi)';
            app.front_brakes_check.FontSize = 10;
            app.front_brakes_check.Position = [25 338 101 22];

            % Create read_brakes_check
            app.read_brakes_check = uicheckbox(app.MRacing2024DataVisualizerUIFigure);
            app.read_brakes_check.Text = 'Rear Brakes (psi)';
            app.read_brakes_check.FontSize = 10;
            app.read_brakes_check.Position = [25 317 100 22];

            % Create brake_bias_check
            app.brake_bias_check = uicheckbox(app.MRacing2024DataVisualizerUIFigure);
            app.brake_bias_check.Text = 'Brake Bias (#)';
            app.brake_bias_check.FontSize = 10;
            app.brake_bias_check.Position = [25 296 85 22];

            % Create fl_speed_check
            app.fl_speed_check = uicheckbox(app.MRacing2024DataVisualizerUIFigure);
            app.fl_speed_check.Text = 'FL Tyre Speed (rpm)';
            app.fl_speed_check.FontSize = 10;
            app.fl_speed_check.Position = [180 380 114 22];

            % Create fr_speed_check
            app.fr_speed_check = uicheckbox(app.MRacing2024DataVisualizerUIFigure);
            app.fr_speed_check.Text = 'FR Tyre Speed (rpm)';
            app.fr_speed_check.FontSize = 10;
            app.fr_speed_check.Position = [180 359 116 22];

            % Create rl_speed_check
            app.rl_speed_check = uicheckbox(app.MRacing2024DataVisualizerUIFigure);
            app.rl_speed_check.Text = 'RL Tyre Speed (rpm)';
            app.rl_speed_check.FontSize = 10;
            app.rl_speed_check.Position = [180 338 115 22];

            % Create rr_speed_check
            app.rr_speed_check = uicheckbox(app.MRacing2024DataVisualizerUIFigure);
            app.rr_speed_check.Text = 'RR Tyre Speed (rpm)';
            app.rr_speed_check.FontSize = 10;
            app.rr_speed_check.Position = [180 317 117 22];

            % % Create avg_speed_check
            % app.avg_speed_check = uicheckbox(app.MRacing2024DataVisualizerUIFigure);
            % app.avg_speed_check.Text = 'Average Tyre Speed (rpm)';
            % app.avg_speed_check.FontSize = 10;
            % app.avg_speed_check.Position = [180 296 139 22];

            % Create vehicle_speed_check
            app.vehicle_speed_check = uicheckbox(app.MRacing2024DataVisualizerUIFigure);
            app.vehicle_speed_check.Text = 'Vehichle Speed (mph)';
            app.vehicle_speed_check.FontSize = 10;
            app.vehicle_speed_check.Position = [335 380 120 22];

            % Create vehichle_heading_check
            app.vehichle_heading_check = uicheckbox(app.MRacing2024DataVisualizerUIFigure);
            app.vehichle_heading_check.Text = '! TODO: Heading (deg)';
            app.vehichle_heading_check.FontSize = 10;
            app.vehichle_heading_check.Position = [335 359 126 22];

            % Create roll_rate_check
            app.roll_rate_check = uicheckbox(app.MRacing2024DataVisualizerUIFigure);
            app.roll_rate_check.Text = 'Roll Rate (deg/s)';
            app.roll_rate_check.FontSize = 10;
            app.roll_rate_check.Position = [335 338 97 22];

            % Create pitch_rate_check
            app.pitch_rate_check = uicheckbox(app.MRacing2024DataVisualizerUIFigure);
            app.pitch_rate_check.Text = 'Pitch Rate (deg/s)';
            app.pitch_rate_check.FontSize = 10;
            app.pitch_rate_check.Position = [335 317 102 22];

            % Create yaw_rate_check
            app.yaw_rate_check = uicheckbox(app.MRacing2024DataVisualizerUIFigure);
            app.yaw_rate_check.Text = 'Yaw Rate (deg/s)';
            app.yaw_rate_check.FontSize = 10;
            app.yaw_rate_check.Position = [335 296 99 22];

            % Create long_gs_check
            app.long_gs_check = uicheckbox(app.MRacing2024DataVisualizerUIFigure);
            app.long_gs_check.Text = 'Longitudinal Gs (g)';
            app.long_gs_check.FontSize = 10;
            app.long_gs_check.Position = [25 265 106 22];

            % Create lat_gs_check
            app.lat_gs_check = uicheckbox(app.MRacing2024DataVisualizerUIFigure);
            app.lat_gs_check.Text = 'Lateral Gs (g)';
            app.lat_gs_check.FontSize = 10;
            app.lat_gs_check.Position = [25 244 83 22];

            % Create vert_gs_check
            app.vert_gs_check = uicheckbox(app.MRacing2024DataVisualizerUIFigure);
            app.vert_gs_check.Text = 'Vertical Gs (g)';
            app.vert_gs_check.FontSize = 10;
            app.vert_gs_check.Position = [25 223 85 22];

            % Create plot_wrt_group
            app.plot_wrt_group = uibuttongroup(app.MRacing2024DataVisualizerUIFigure);
            app.plot_wrt_group.Title = 'Plot w.r.t';
            app.plot_wrt_group.Position = [20 114 123 85];

            % Create time_button
            app.time_button = uitogglebutton(app.plot_wrt_group);
            app.time_button.Text = 'time';
            app.time_button.Position = [11 31 100 23];
            app.time_button.Value = true;

            % Create distance_button
            app.distance_button = uitogglebutton(app.plot_wrt_group);
            app.distance_button.Text = 'distance';
            app.distance_button.Position = [11 10 100 23];

            % Show the figure after all components are created
            app.MRacing2024DataVisualizerUIFigure.Visible = 'on';
        end
    end

    % App creation and deletion
    methods (Access = public)

        % Construct app
        function app = data_visualizer_exported

            % Create UIFigure and components
            createComponents(app)

            % Register the app with App Designer
            registerApp(app, app.MRacing2024DataVisualizerUIFigure)

            if nargout == 0
                clear app
            end
        end

        % Code that executes before app deletion
        function delete(app)

            % Delete UIFigure when app is deleted
            delete(app.MRacing2024DataVisualizerUIFigure)
        end
    end
end
##### SOURCE END #####
-->
</body>
</html>
